---
# tasks file for roles/ec2_security_group
- name: find vpc id for sg object "{{ object_tag_identifier }}"
  ec2_vpc_subnet_info:
    region: "{{ region }}"
    filters:
      "tag:environment": test
  register: vpc_net_info_output

- name: display some output
  debug: var=vpc_net_info_output

- set_fact:
  vpc_id_input:   "{{ vpc_net_info_output.subnets.vpc_id }}"

- name: display some output
  debug: var=vpc_id_input  

- name: ensure security group is present
  ec2_group:
    state: present
    name: "{{ ec2_group_name }}"
    description: Inbound WinRM and RDP
    vpc_id: "{{ vpc_id_input }}"
    region: "{{ region }}"
    rules:
    - proto: tcp
      from_port: 80
      to_port: 80
      cidr_ip: 0.0.0.0/0
    - proto: tcp
      from_port: 5986
      to_port: 5986
      cidr_ip: 0.0.0.0/0
    - proto: tcp
      from_port: 3389
      to_port: 3389
      cidr_ip: 0.0.0.0/0
      rules_egress:
    - proto: -1
      cidr_ip: 0.0.0.0/0
  register: sg_output